@page "/productreport"

@rendermode InteractiveServer

@inject ISearchProductTransactionsUseCase SearchProductTransactionUseCase

<h3>Product Transactions</h3>
<br />

<div class="row">
	<div class="col">
		<label for="prod">Product Name</label>
		<input type="text" id="prod" class="form-control" @bind-value="prodName" />"
	</div>
	<div class="col">
		<label for="df">Date From</label>
		<input type="date" id="df" class="form-control" @bind-value="dateFrom" />
	</div>
	<div class="col">
		<label for="dt">Date To</label>
		<input type="date" id="dt" class="form-control" @bind-value="dateTo" />
	</div>
	<div class="col">
		<label for="at">Activity Type</label>
		<select id="at" class="form-control" @bind="activityTypeId">
			<option value="0"></option>
			<option value="1">Produce Product</option>
			<option value="2">Sell Product</option>
		</select>
	</div>
	<div class="col">
		<label>&nbsp;</label>
		<button type="button" class="btn btn-primary form-control" @onclick="SearchProducts">Search</button>
	</div>
</div>

@if(productTransactions != null && productTransactions.Any())
{
	<table class="table">
		<thead>
			<tr>
				<th>Date</th>
				<th>Product</th>
				<th>Activity</th>
				<th>Quantity Before</th>
				<th>Quantity After</th>
				<th>Unit Price</th>
				<th>SO#</th>
				<th>Production #</th>
			</tr>
		</thead>
		<tbody>
			@foreach (var transaction in productTransactions)
			{
				<tr>
					<td>@transaction.TransactionDate.ToString("MM/dd/yyyy")</td>
					<td>@transaction.Product.ProductName</td>
					<td>
						@if(transaction.ActivityType == ProductTransactionType.ProduceProduct)
						{
							<text>Produce Product</text>
						}
						else if(transaction.ActivityType == ProductTransactionType.SellProduct)
						{
							<text>Sell Product</text>
						}
					</td>
					<td>@transaction.QuantityBefore</td>
					<td>@transaction.QuantityAfter</td>
					<td>@transaction.UnitPrice?.ToString("c")</td>
					<td>@transaction.SONumber</td>
					<td>@transaction.ProductionNumber</td>
				</tr>
			}
		</tbody>
	</table>
}


@code {
	private string prodName;
	private DateTime? dateFrom;
	private DateTime? dateTo;
	private int activityTypeId;
	private IEnumerable<ProductTransaction>? productTransactions;

	private async Task SearchProducts()
	{
		ProductTransactionType? prodType = null;
		if (activityTypeId != 0) prodType = (ProductTransactionType)activityTypeId;
		
		productTransactions = await SearchProductTransactionUseCase.ExecuteAsync(prodName, dateFrom, dateTo, prodType);
	}

}
